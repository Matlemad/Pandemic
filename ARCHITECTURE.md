# ğŸ—ï¸ PANDEMIC - Documentazione Architetturale

Questo documento descrive in dettaglio l'architettura, le decisioni di design e i protocolli utilizzati in Pandemic.

---

## ğŸ“‹ Indice

1. [Risposte alle Domande di Design](#risposte-alle-domande-di-design)
2. [Diagramma Architetturale](#diagramma-architetturale)
3. [Matrice Decisionale BLE vs Wi-Fi LAN](#matrice-decisionale)
4. [Protocollo di Comunicazione](#protocollo-di-comunicazione)
5. [Formati dei Messaggi](#formati-dei-messaggi)
6. [Gestione degli Edge Case](#gestione-degli-edge-case)
7. [Limitazioni di Piattaforma](#limitazioni-di-piattaforma)

---

## 1. Risposte alle Domande di Design

### 1.1 Qual Ã¨ il ruolo della Room?

**Risposta: (a) Index + Coordinator**

La Room Ã¨ un **coordinatore e indice**, NON un ponte dati. Ecco il modello:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ROOM (HOST)                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    RESPONSABILITÃ€                        â”‚   â”‚
â”‚  â”‚  âœ“ Mantenere lista dei peer connessi                    â”‚   â”‚
â”‚  â”‚  âœ“ Aggregare metadati file condivisi                    â”‚   â”‚
â”‚  â”‚  âœ“ Facilitare le presentazioni tra peer                 â”‚   â”‚
â”‚  â”‚  âœ“ Broadcast aggiornamenti indice                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  âœ— NON memorizzare file audio                           â”‚   â”‚
â”‚  â”‚  âœ— NON fare proxy di trasferimenti                      â”‚   â”‚
â”‚  â”‚  âœ— NON agire come cache centrale                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Mental Model:                                                  â”‚
â”‚  "La room presenta le persone. Loro si scambiano file          â”‚
â”‚   privatamente."                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Flusso tipico:**
1. Guest A vuole scaricare file da Guest B
2. Guest A chiede alla Room l'indirizzo di Guest B
3. Room risponde con indirizzo LAN di Guest B
4. Guest A si connette DIRETTAMENTE a Guest B
5. Trasferimento avviene peer-to-peer
6. Room non vede mai i dati del file

### 1.2 WebRTC Ã¨ adatto qui?

**Risposta: NO, WebRTC NON Ã¨ adatto**

WebRTC richiede:
- âŒ **STUN servers** per scoprire l'IP pubblico
- âŒ **TURN servers** per relay quando P2P fallisce
- âŒ **Signaling server** per scambio SDP
- âŒ **IP networking** (non funziona su BLE)

Il nostro scenario:
- âœ… Nessun server Internet
- âœ… Solo rete locale
- âœ… BLE per discovery
- âœ… Wi-Fi LAN per trasferimento

**Alternative corrette:**
- HTTP streaming su LAN
- WebSocket su LAN
- TCP/UDP custom su LAN
- BLE GATT per fallback

### 1.3 Qual Ã¨ il protocollo di trasferimento esatto?

**Path Primario: HTTP over Wi-Fi LAN**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PROTOCOLLO DI TRASFERIMENTO                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  MODE: Wi-Fi LAN (Primario)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  Requester                           Owner                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”€â”€â”€â”€â”€                      â”‚
â”‚                                                                 â”‚
â”‚  1. GET /files/{fileId}                                         â”‚
â”‚     Headers:                                                    â”‚
â”‚       - X-Session-Token: {token}                               â”‚
â”‚       - Range: bytes=0- (opzionale)                            â”‚
â”‚                                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
â”‚                                                                 â”‚
â”‚                                   2. Verifica token            â”‚
â”‚                                   3. Streaming risposta:       â”‚
â”‚                                      - 200 OK                  â”‚
â”‚                                      - Content-Type: audio/*   â”‚
â”‚                                      - Content-Length: {size}  â”‚
â”‚                                      - Transfer-Encoding:      â”‚
â”‚                                        chunked                 â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚                                                                 â”‚
â”‚  4. Riceve chunks                                              â”‚
â”‚  5. Scrive su filesystem                                       â”‚
â”‚  6. Aggiorna progresso UI                                      â”‚
â”‚  7. Notifica completamento a Room                              â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  MODE: BLE Only (Fallback)                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  Caratteristiche:                                              â”‚
â”‚  â€¢ Chunk size: 512 bytes (MTU-dependent)                       â”‚
â”‚  â€¢ Throughput: ~50-200 KB/s                                    â”‚
â”‚  â€¢ ACK ogni 8 chunks                                           â”‚
â”‚  â€¢ Retry su timeout                                            â”‚
â”‚  â€¢ Checksum finale                                             â”‚
â”‚                                                                 â”‚
â”‚  Protocollo:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [SEQ:4][FLAGS:1][DATA:507]                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  FLAGS:                                                  â”‚   â”‚
â”‚  â”‚    0x01 = START (primo chunk)                           â”‚   â”‚
â”‚  â”‚    0x02 = END (ultimo chunk)                            â”‚   â”‚
â”‚  â”‚    0x04 = ACK_REQUEST (richiede conferma)               â”‚   â”‚
â”‚  â”‚    0x08 = RETRY (ritrasmissione)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Diagramma Architetturale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PANDEMIC - ARCHITETTURA                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                              â”‚   VENUE     â”‚                                â”‚
â”‚                              â”‚  (LUOGO)    â”‚                                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚          â”‚                          â”‚                          â”‚           â”‚
â”‚          â–¼                          â–¼                          â–¼           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   DEVICE A  â”‚    BLE     â”‚   DEVICE B  â”‚    BLE    â”‚   DEVICE C  â”‚     â”‚
â”‚   â”‚   (HOST)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (GUEST)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (GUEST)   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                          â”‚                          â”‚           â”‚
â”‚          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚
â”‚          â”‚     â”‚    LOCAL WI-FI NETWORK (No Internet)    â”‚    â”‚           â”‚
â”‚          â”‚     â”‚         192.168.x.x / 10.0.x.x          â”‚    â”‚           â”‚
â”‚          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚
â”‚          â”‚                          â”‚                          â”‚           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                     â”‚                                       â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â”‚   DIRECT P2P        â”‚                           â”‚
â”‚                          â”‚   HTTP/WebSocket    â”‚                           â”‚
â”‚                          â”‚   FILE TRANSFER     â”‚                           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             DEVICE ARCHITECTURE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          UI LAYER                                   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Home   â”‚ â”‚  Host   â”‚ â”‚  Join   â”‚ â”‚  Room   â”‚ â”‚   Library   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Screen  â”‚ â”‚ Screen  â”‚ â”‚ Screen  â”‚ â”‚ Screen  â”‚ â”‚   Screen    â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚          â”‚          â”‚          â”‚          â”‚              â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        STATE LAYER (Zustand)                       â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  appStore   â”‚  â”‚  roomStore  â”‚  â”‚     transferStore       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ deviceId    â”‚  â”‚ room        â”‚  â”‚ transfers[]             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ deviceName  â”‚  â”‚ role        â”‚  â”‚ activeCount             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ settings    â”‚  â”‚ peers[]     â”‚  â”‚ progress                â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ networkCaps â”‚  â”‚ files[]     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚          â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                       SERVICE LAYER                               â”‚     â”‚
â”‚  â”‚                                                                    â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  â”‚  RoomService â”‚ â”‚ AudioLibrary â”‚ â”‚     TransferService      â”‚  â”‚     â”‚
â”‚  â”‚  â”‚              â”‚ â”‚   Service    â”‚ â”‚                          â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ createRoom â”‚ â”‚ â€¢ scanFiles  â”‚ â”‚ â€¢ downloadFile           â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ joinRoom   â”‚ â”‚ â€¢ importFile â”‚ â”‚ â€¢ uploadFile             â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ leaveRoom  â”‚ â”‚ â€¢ getMetadataâ”‚ â”‚ â€¢ trackProgress          â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ shareFiles â”‚ â”‚ â€¢ deleteFile â”‚ â”‚ â€¢ handleErrors           â”‚  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                      TRANSPORT LAYER                              â”‚     â”‚
â”‚  â”‚                                                                    â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  â”‚      BLE Service       â”‚  â”‚       Network Service          â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ BLE advertising      â”‚  â”‚ â€¢ HTTP server (host)           â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ BLE scanning         â”‚  â”‚ â€¢ HTTP client (guest)          â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ GATT characteristics â”‚  â”‚ â€¢ WebSocket coordination       â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Room discovery       â”‚  â”‚ â€¢ File streaming               â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Handshake            â”‚  â”‚ â€¢ Network state detection      â”‚  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                       STORAGE LAYER                               â”‚     â”‚
â”‚  â”‚                                                                    â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  â”‚    AsyncStorage        â”‚  â”‚       FileSystem               â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Device settings      â”‚  â”‚ â€¢ Audio files                  â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Cached metadata      â”‚  â”‚ â€¢ Imported files               â”‚  â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Device identity      â”‚  â”‚ â€¢ Downloaded files             â”‚  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Matrice Decisionale

### BLE vs Wi-Fi LAN

| Criterio | BLE | Wi-Fi LAN | Vincitore | Note |
|----------|-----|-----------|-----------|------|
| **DisponibilitÃ ** | Sempre | Richiede rete | BLE | BLE non richiede infrastruttura |
| **Discovery** | Eccellente | Richiede mDNS | BLE | BLE broadcast nativo |
| **Throughput** | 50-200 KB/s | 10-100+ Mbps | Wi-Fi | 100x+ differenza |
| **Range** | 10-30m | 50-100m | Wi-Fi | Dipende da ambiente |
| **Consumo batteria (idle)** | Molto basso | Basso | BLE | BLE ottimizzato |
| **Consumo batteria (transfer)** | Alto (lungo) | Medio (veloce) | Wi-Fi | Wi-Fi finisce prima |
| **Background iOS** | Molto limitato | Limitato | Pari | Entrambi problematici |
| **Setup utente** | Zero | Connetti a WiFi | BLE | BLE automatico |
| **File > 5MB** | Impraticabile | Ottimo | Wi-Fi | BLE troppo lento |
| **AffidabilitÃ ** | Buona | Eccellente | Wi-Fi | Wi-Fi piÃ¹ stabile |

### Decisione Finale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DECISIONE ARCHITETTURALE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     BLE (Bluetooth)                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Usato per:                                              â”‚   â”‚
â”‚  â”‚  âœ“ Discovery stanze                                      â”‚   â”‚
â”‚  â”‚  âœ“ Handshake iniziale                                    â”‚   â”‚
â”‚  â”‚  âœ“ Scambio metadati piccoli (< 1KB)                     â”‚   â”‚
â”‚  â”‚  âœ“ Fallback mode (file piccoli, emergenza)              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  NON usato per:                                          â”‚   â”‚
â”‚  â”‚  âœ— Trasferimento file audio                              â”‚   â”‚
â”‚  â”‚  âœ— Streaming dati                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Wi-Fi LAN                            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Usato per:                                              â”‚   â”‚
â”‚  â”‚  âœ“ Trasferimento file audio                              â”‚   â”‚
â”‚  â”‚  âœ“ Coordinazione real-time (WebSocket)                  â”‚   â”‚
â”‚  â”‚  âœ“ Streaming grandi volumi dati                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Prerequisito:                                           â”‚   â”‚
â”‚  â”‚  â€¢ Stessa rete Wi-Fi locale                              â”‚   â”‚
â”‚  â”‚  â€¢ No Internet richiesto                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Protocollo di Comunicazione

### 4.1 Flusso Completo

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         PANDEMIC PROTOCOL v1.0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PHASE 1: ROOM CREATION (HOST)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   HOST DEVICE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                                    â”‚
   â”‚  1. User action: "Create Room"                                    â”‚
   â”‚                                                                    â”‚
   â”‚  2. Generate identifiers:                                         â”‚
   â”‚     â€¢ roomId: UUID v4                                             â”‚
   â”‚     â€¢ hostId: UUID v4 (persisted)                                 â”‚
   â”‚     â€¢ sessionKey: random 32 bytes                                 â”‚
   â”‚                                                                    â”‚
   â”‚  3. Detect network:                                               â”‚
   â”‚     â€¢ Check Wi-Fi connection                                      â”‚
   â”‚     â€¢ Get local IP (if available)                                 â”‚
   â”‚     â€¢ Determine transport mode                                    â”‚
   â”‚                                                                    â”‚
   â”‚  4. Start BLE advertising:                                        â”‚
   â”‚     Service UUID: 0000FDA0-0000-1000-8000-00805F9B34FB            â”‚
   â”‚     Advertisement data:                                           â”‚
   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
   â”‚     â”‚ Name: "P|{roomId}|{roomName}"               â”‚              â”‚
   â”‚     â”‚ ManufData: {hostId, hostName, wifiAvail...} â”‚              â”‚
   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
   â”‚                                                                    â”‚
   â”‚  5. Start HTTP server (if Wi-Fi):                                 â”‚
   â”‚     Port: 8080                                                    â”‚
   â”‚     Endpoints:                                                    â”‚
   â”‚     â€¢ GET  /room           â†’ Room state                           â”‚
   â”‚     â€¢ POST /join           â†’ Join request                         â”‚
   â”‚     â€¢ GET  /files          â†’ File index                           â”‚
   â”‚     â€¢ GET  /files/{id}     â†’ Download file                        â”‚
   â”‚     â€¢ WS   /ws             â†’ Real-time events                     â”‚
   â”‚                                                                    â”‚
   â”‚  6. Initialize room state:                                        â”‚
   â”‚     { peers: [], files: [], createdAt: timestamp }                â”‚
   â”‚                                                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 2: DISCOVERY (GUEST)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   GUEST DEVICE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                                    â”‚
   â”‚  1. User action: "Find Rooms"                                     â”‚
   â”‚                                                                    â”‚
   â”‚  2. Request BLE permissions (if needed)                           â”‚
   â”‚                                                                    â”‚
   â”‚  3. Start BLE scanning:                                           â”‚
   â”‚     Filter: Service UUID 0000FDA0-...                             â”‚
   â”‚     Options: { allowDuplicates: true }                            â”‚
   â”‚                                                                    â”‚
   â”‚  4. For each discovered device:                                   â”‚
   â”‚     â€¢ Parse advertisement name                                    â”‚
   â”‚     â€¢ Extract: roomId, roomName                                   â”‚
   â”‚     â€¢ Parse manufacturer data (if present)                        â”‚
   â”‚     â€¢ Record RSSI for sorting                                     â”‚
   â”‚     â€¢ Add to discovered rooms list                                â”‚
   â”‚                                                                    â”‚
   â”‚  5. Maintain room list:                                           â”‚
   â”‚     â€¢ Update last_seen timestamp                                  â”‚
   â”‚     â€¢ Remove rooms not seen for 15s                               â”‚
   â”‚     â€¢ Sort by RSSI (signal strength)                              â”‚
   â”‚                                                                    â”‚
   â”‚  6. Display to user:                                              â”‚
   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
   â”‚     â”‚ ğŸ“¶ DJ Set @ Club          â–ˆâ–ˆâ–ˆâ–ˆ Host1 â”‚                      â”‚
   â”‚     â”‚ ğŸ“¶ Chill Zone             â–ˆâ–ˆâ–ˆ  Host2 â”‚                      â”‚
   â”‚     â”‚ ğŸ“¶ Live Recording         â–ˆâ–ˆ   Host3 â”‚                      â”‚
   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
   â”‚                                                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 3: JOIN (HANDSHAKE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   GUEST                                         HOST
   â”€â”€â”€â”€â”€                                         â”€â”€â”€â”€

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 1. Connect via BLE   â”‚
   â”‚    GATT              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  BLE GATT Connection
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                     â”‚ 2. Accept connection  â”‚
              â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 3. Write to JOIN     â”‚
   â”‚    characteristic:   â”‚
   â”‚    {peerId, peerName}â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  JOIN_REQUEST
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                     â”‚ 4. Validate request   â”‚
              â”‚                                     â”‚ 5. Generate token     â”‚
              â”‚                                     â”‚ 6. Add to pending     â”‚
              â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                                 â”‚
              â”‚                                     JOIN_RESPONSE
              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  {success, token,
              â”‚                                      hostAddress}
              â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 7. Disconnect BLE    â”‚
   â”‚    (handshake done)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  [If Wi-Fi available]
              â”‚
              â”‚  HTTP POST /join
              â”‚  { peerId, peerName, sessionToken }
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                     â”‚ 8. Validate token     â”‚
              â”‚                                     â”‚ 9. Add to peers[]     â”‚
              â”‚                                     â”‚ 10. Broadcast:        â”‚
              â”‚                                     â”‚     PEER_JOINED       â”‚
              â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                                 â”‚
              â”‚                                     200 OK
              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  { roomState }
              â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 11. Connect WebSocketâ”‚
   â”‚     for real-time    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  WS /ws?token={token}
              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  (bidirectional)


PHASE 4: METADATA SYNC
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   GUEST                                         HOST
   â”€â”€â”€â”€â”€                                         â”€â”€â”€â”€

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 1. Select files to   â”‚
   â”‚    share             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  WS: SHARE_FILES
              â”‚  { files: [
              â”‚      { id, title, artist, duration, size, format }
              â”‚    ]
              â”‚  }
              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                     â”‚ 2. Add to room index  â”‚
              â”‚                                     â”‚ 3. Associate with     â”‚
              â”‚                                     â”‚    peer address       â”‚
              â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                                 â”‚
              â”‚                                     WS: INDEX_UPDATED
              â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•(broadcast to all)
              â”‚                                     { files: [...] }


PHASE 5: FILE TRANSFER (P2P)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   GUEST A                  HOST                 GUEST B
   (Requester)              â”€â”€â”€â”€                 (Owner)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 1. Select file       â”‚
   â”‚    owned by Guest B  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  WS: REQUEST_FILE
              â”‚  { fileId, ownerId }
              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚ 2. Lookup owner        â”‚
              â”‚                         â”‚    in peers[]          â”‚
              â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                      â”‚
              â”‚                         WS: FILE_AVAILABLE
              â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• { fileId, ownerAddress }
              â”‚
              â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  â”‚           DIRECT P2P CONNECTION             â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  HTTP GET /files/{fileId}
              â”‚  Headers: X-Session-Token: {token}
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
              â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                                  â”‚ 3. Validate  â”‚
              â”‚                                                  â”‚ 4. Open file â”‚
              â”‚                                                  â”‚ 5. Stream    â”‚
              â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                                         â”‚
              â”‚  200 OK                                                 â”‚
              â”‚  Content-Type: audio/mpeg                               â”‚
              â”‚  Content-Length: 5242880                                â”‚
              â”‚  Transfer-Encoding: chunked                             â”‚
              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 6. Receive chunks    â”‚
   â”‚ 7. Write to disk     â”‚
   â”‚ 8. Update progress   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚  WS: TRANSFER_COMPLETED
              â”‚  { fileId, transferId }
              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  (notify room)
```

---

## 5. Formati dei Messaggi

### 5.1 BLE Advertisement

```typescript
// Device Name Format (max 29 chars)
"P|{roomId:8}|{roomName:encoded}"

// Example
"P|a1b2c3d4|DJ%20Set%20Night"

// Manufacturer Data (JSON, base64 encoded)
{
  "v": 1,                      // Protocol version
  "hId": "host-uuid",          // Host ID
  "hN": "DJ Marco",            // Host Name
  "wifi": true,                // Wi-Fi available
  "addr": "192.168.1.42:8080"  // Host address
}
```

### 5.2 WebSocket Messages

```typescript
// Base Message
interface BaseMessage {
  type: MessageType;
  timestamp: number;
  senderId: string;
}

// Message Types
enum MessageType {
  JOIN_ROOM = 'join_room',
  LEAVE_ROOM = 'leave_room',
  ROOM_STATE = 'room_state',
  PEER_JOINED = 'peer_joined',
  PEER_LEFT = 'peer_left',
  ROOM_CLOSING = 'room_closing',
  SHARE_FILES = 'share_files',
  UNSHARE_FILES = 'unshare_files',
  INDEX_UPDATED = 'index_updated',
  REQUEST_FILE = 'request_file',
  FILE_AVAILABLE = 'file_available',
  TRANSFER_STARTED = 'transfer_started',
  TRANSFER_PROGRESS = 'transfer_progress',
  TRANSFER_COMPLETED = 'transfer_completed',
  TRANSFER_FAILED = 'transfer_failed',
  PING = 'ping',
  PONG = 'pong',
  ERROR = 'error',
}

// Example: Share Files
{
  "type": "share_files",
  "timestamp": 1703270400000,
  "senderId": "peer-uuid",
  "files": [
    {
      "fileId": "file-uuid",
      "fileName": "track.mp3",
      "title": "My Track",
      "artist": "Artist Name",
      "duration": 234,
      "sizeBytes": 5242880,
      "format": "mp3",
      "checksum": "sha256:abc..."
    }
  ]
}

// Example: Request File
{
  "type": "request_file",
  "timestamp": 1703270400000,
  "senderId": "requester-uuid",
  "fileId": "file-uuid",
  "requesterId": "requester-uuid"
}

// Example: File Available
{
  "type": "file_available",
  "timestamp": 1703270400000,
  "senderId": "host-uuid",
  "fileId": "file-uuid",
  "ownerAddress": "192.168.1.50:8080",
  "transportMode": "wifi_lan"
}
```

---

## 6. Gestione degli Edge Case

### 6.1 Host Disconnection

```
SCENARIO: L'host chiude l'app o perde connessione
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DETECTION:
â€¢ WebSocket disconnection timeout: 5s
â€¢ Missing PONG response: 3 retries

HANDLING:
1. Guests ricevono: WS connection closed
2. UI mostra: "Room closed"
3. Auto-cleanup dopo 10s
4. Trasferimenti in corso: CANCELLED
5. File parziali: eliminati

RECOVERY:
â€¢ Guest puÃ² cercare nuove room
â€¢ Nessun dato perso (file giÃ  completati salvati)
```

### 6.2 Network Drop

```
SCENARIO: Wi-Fi temporaneamente non disponibile
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DETECTION:
â€¢ HTTP request timeout: 10s
â€¢ WebSocket ping timeout: 5s

HANDLING:
1. Trasferimenti: PAUSED
2. UI mostra: "Connessione persa"
3. Retry automatico ogni 5s (max 3 tentativi)

RECOVERY (se rete torna):
1. Riconnessione WebSocket
2. Re-sync stato room
3. Resume trasferimenti (se supportato)

FALLBACK (se rete non torna):
1. Switch a BLE-only mode (se abilitato)
2. Trasferimenti file grandi: CANCELLED
3. Solo metadati via BLE
```

### 6.3 Partial Transfer

```
SCENARIO: Trasferimento interrotto a metÃ 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CAUSES:
â€¢ Network drop
â€¢ Peer disconnection
â€¢ App backgrounded (iOS)

HANDLING:
1. File parziale salvato con estensione .partial
2. Metadata preservati
3. Progress salvato

RECOVERY:
â€¢ Se peer disponibile: resume con Range header
â€¢ Se peer non disponibile: retry completo o cancel

CLEANUP:
â€¢ File .partial eliminati dopo 24h
â€¢ O quando utente cancella manualmente
```

---

## 7. Limitazioni di Piattaforma

### 7.1 iOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         iOS LIMITATIONS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BLE:                                                           â”‚
â”‚  âš ï¸ Background scanning: molto limitato                        â”‚
â”‚  âš ï¸ Background advertising: solo con permission speciale       â”‚
â”‚  âœ“ Foreground: funziona bene                                   â”‚
â”‚                                                                 â”‚
â”‚  Network:                                                       â”‚
â”‚  âš ï¸ Local network permission richiesta (iOS 14+)               â”‚
â”‚  âš ï¸ Background transfers: limitati                             â”‚
â”‚  âœ“ Foreground: funziona bene                                   â”‚
â”‚                                                                 â”‚
â”‚  Best Practices:                                                â”‚
â”‚  â€¢ Mantieni app in foreground durante trasferimenti            â”‚
â”‚  â€¢ Usa screen wake lock                                        â”‚
â”‚  â€¢ Mostra progress prominente                                  â”‚
â”‚  â€¢ Avvisa utente se va in background                           â”‚
â”‚                                                                 â”‚
â”‚  Required Info.plist keys:                                      â”‚
â”‚  â€¢ NSBluetoothAlwaysUsageDescription                           â”‚
â”‚  â€¢ NSBluetoothPeripheralUsageDescription                       â”‚
â”‚  â€¢ NSLocalNetworkUsageDescription                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Android

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ANDROID LIMITATIONS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BLE:                                                           â”‚
â”‚  âš ï¸ Requires location permission (Android 10+)                 â”‚
â”‚  âš ï¸ BLUETOOTH_SCAN, BLUETOOTH_CONNECT (Android 12+)            â”‚
â”‚  âœ“ Background: piÃ¹ permissivo di iOS                           â”‚
â”‚  âœ“ Throughput: generalmente superiore                          â”‚
â”‚                                                                 â”‚
â”‚  Network:                                                       â”‚
â”‚  âœ“ Local network: nessuna permission speciale                  â”‚
â”‚  âš ï¸ Background: Doze mode puÃ² interferire                      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ mDNS/NSD (Android 10-11):                                  â”‚
â”‚  âŒ NsdManager puÃ² risolvere UN servizio alla volta            â”‚
â”‚  âŒ errorCode:3 (ALREADY_ACTIVE) frequente                     â”‚
â”‚  âŒ Discovery inaffidabile anche con workaround                â”‚
â”‚  â†’ Usare connessione manuale o hotspot mode                    â”‚
â”‚                                                                 â”‚
â”‚  Best Practices:                                                â”‚
â”‚  â€¢ Request all permissions upfront                             â”‚
â”‚  â€¢ Use foreground service for long transfers                   â”‚
â”‚  â€¢ Handle Doze mode properly                                   â”‚
â”‚  â€¢ Acquire WiFi Multicast Lock for mDNS                        â”‚
â”‚                                                                 â”‚
â”‚  Required permissions:                                          â”‚
â”‚  â€¢ BLUETOOTH                                                    â”‚
â”‚  â€¢ BLUETOOTH_ADMIN                                              â”‚
â”‚  â€¢ BLUETOOTH_SCAN                                               â”‚
â”‚  â€¢ BLUETOOTH_CONNECT                                            â”‚
â”‚  â€¢ BLUETOOTH_ADVERTISE                                          â”‚
â”‚  â€¢ ACCESS_FINE_LOCATION                                         â”‚
â”‚  â€¢ ACCESS_WIFI_STATE                                            â”‚
â”‚  â€¢ CHANGE_WIFI_MULTICAST_STATE                                  â”‚
â”‚  â€¢ READ_MEDIA_AUDIO (Android 13+)                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Riferimenti

- [Bluetooth Low Energy Core Specification](https://www.bluetooth.com/specifications/specs/core-specification/)
- [React Native BLE PLX](https://github.com/dotintent/react-native-ble-plx)
- [Expo File System](https://docs.expo.dev/versions/latest/sdk/filesystem/)
- [Apple Local Network Privacy](https://developer.apple.com/documentation/bundleresources/information_property_list/nslocalnetworkusagedescription)

---

*Documento generato per PANDEMIC v1.2.0*  
*Ultimo aggiornamento: 2026-01-12*

